"use strict";angular.module("corporateDashboardApp",["leaflet-directive","ui.router","chart.js"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/geospatial.html",controller:"GeospatialCtrl as geospatial"}).state("metrics",{url:"/metrics",templateUrl:"views/metrics.html",controller:"MetricsCtrl as metrics"}).state("data",{url:"/data",templateUrl:"views/data.html",controller:"DataCtrl as data"})}]),angular.module("corporateDashboardApp").controller("GeospatialCtrl",["$stateParams","officeFinder",function(a,b){var c=this;c.mapcenter={lat:0,lng:0,zoom:2},b.getOffices().then(function(a){c.offices=a;var b=[];$.each(a,function(a,c){var d={lat:c.lat,lng:c["long"],message:c.employee_number+" employees.",draggable:!1,focus:!1};0==a&&(d.focus=!0),b.push(d)}),angular.extend(c,{markers:b,defaults:{scrollWheelZoom:!1}})})}]),angular.module("corporateDashboardApp").service("officeFinder",function(){this.getOffices=function(){return $.get("/data/geospatial.json")}}),angular.module("corporateDashboardApp").controller("MetricsCtrl",["metricsGatherer","$interval",function(a,b){var c=this;a.getMetrics().then(function(a){c.open_issues=a.open_issues}),b(function(){var a=1e3,b=10;c.open_issues=Math.floor(Math.random()*(a-b+1))+b},2e3)}]),angular.module("corporateDashboardApp").controller("DataCtrl",["issueFinder",function(a){var b=this;b.order="submission_timestamp",b.setOrder=function(a){a==b.order?b.order="-"+a:b.order=a},b.getOrderClass=function(a){return b.order.includes(a)?b.order.includes("-")?"des":"asc":"dis"},a.getIssues().then(function(a){var c=Papa.parse(a,{header:!0});b.issues=c.data})}]),angular.module("corporateDashboardApp").controller("HeaderCtrl",["$state",function(a){var b,c=this;b=window.location.href.includes("data")?"data":window.location.href.includes("metrics")?"metrics":"home",c.currentStateName=b,c.setCurrent=function(a){c.currentStateName=a}}]),angular.module("corporateDashboardApp").service("issueFinder",function(){this.getIssues=function(){return $.get("/data/issues_data.csv")}}),angular.module("corporateDashboardApp").service("metricsGatherer",function(){var a=this;a.data={},this.getMetrics=function(){return $.get("/data/metrics.json")},this.getOpenIssues=function(){$.get("/data/metrics.json").then(function(b){return a.data=b,a.data.open_issues})},this.getPayingCustomers=function(){return a.data.paying_customers},this.getReportedIssues=function(){return a.data.reported_issues}}),angular.module("corporateDashboardApp").controller("LinechartCtrl",["metricsGatherer","$interval",function(a,b){function c(a,b){var c=new Date(a);return c.setDate(c.getDate()+b),c}var d=this;a.getMetrics().then(function(a){d.paying_customers=a.paying_customers,d.labels=d.paying_customers.map(function(a){return a.day}),d.series=["Customers"],d.data=d.paying_customers.map(function(a){return a.number}),d.options={animation:!1}}),b(function(){var a=2e3,b=1,e=new Date(d.labels[d.labels.length-1]),f=c(e,1),g=f.getMonth()+1+"/"+f.getDate()+"/"+f.getFullYear(),h=Math.floor(Math.random()*(a-b+1))+b;d.labels.shift(),d.data.shift(),d.labels.push(g.toLocaleString()),d.data.push(h)},700)}]),angular.module("corporateDashboardApp").controller("BarchartCtrl",["metricsGatherer","$interval",function(a,b){function c(a,b){var c=new Date(a);return c.setDate(c.getDate()+b),c}var d=this;a.getMetrics().then(function(a){d.reported_issues=a.reported_issues,d.labels=d.reported_issues.map(function(a){return a.day}),d.series=["Reported Issues"],d.data=d.reported_issues.map(function(a){return a.number}),d.options={animation:!1}}),b(function(){var a=2e3,b=1,e=new Date(d.labels[d.labels.length-1]),f=c(e,1),g=f.getMonth()+1+"/"+f.getDate()+"/"+f.getFullYear(),h=Math.floor(Math.random()*(a-b+1))+b;d.labels.shift(),d.data.shift(),d.labels.push(g.toLocaleString()),d.data.push(h)},2e3)}]),angular.module("corporateDashboardApp").run(["$templateCache",function(a){a.put("views/bar.html",'<canvas id="bar" class="chart chart-bar" chart-data="bar.data" chart-labels="bar.labels" chart-series="bar.series" chart-options="bar.options"> </canvas>'),a.put("views/data.html",'<div class="row"> <div class="col-sm-12"> <form class="form-inline pull-right"> <div class="form-group"> <label for="search">Search: </label> <input id="search" class="form-control" placeholder="Some text to find" ng-model="searchText"> </div> </form></div> </div>  <div class="row"> <div class="col-sm-12"> <table class="table table-striped table-hover"> <thead> <tr> <th class="pointer" ng-class="data.getOrderClass(\'submission_timestamp\')" ng-click="data.setOrder(\'submission_timestamp\')">Submission Timestamp</th> <th class="pointer" ng-class="data.getOrderClass(\'customer_name\')" ng-click="data.setOrder(\'customer_name\')">Customer Name</th> <th class="pointer" ng-class="data.getOrderClass(\'customer_email\')" ng-click="data.setOrder(\'customer_email\')">Customer Email Address</th> <th class="pointer" ng-class="data.getOrderClass(\'description\')" ng-click="data.setOrder(\'description\')">Description</th> <th class="pointer" ng-class="data.getOrderClass(\'status\')" ng-click="data.setOrder(\'status\')">Status</th> <th class="pointer" ng-class="data.getOrderClass(\'closed_timestamp\')" ng-click="data.setOrder(\'closed_timestamp\')">Closed Timestamp</th> <th class="pointer" ng-class="data.getOrderClass(\'employee_name\')" ng-click="data.setOrder(\'employee_name\')">Employee Name</th> </tr> </thead> <tbody> <tr ng-repeat="issue in data.issues | orderBy: data.order | filter:searchText as filtered"> <td>{{issue.submission_timestamp | date:\'yyyy-MM-dd HH:mm\'}}</td> <td>{{issue.customer_name}}</td> <td>{{issue.customer_email}}</td> <td>{{issue.description}}</td> <td><span class="label" ng-class="issue.status == \'closed\' ? \'label-success\' : \'label-primary\'">{{issue.status}}</span></td> <td>{{issue.closed_timestamp | date:\'yyyy-MM-dd HH:mm\'}}</td> <td>{{issue.employee_name}}</td> </tr> </tbody> </table> <div ng-if="filtered.length == 0" class="text-center"> <p> <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> We couldn\'t find any issues, try changing the search text. ("{{searchText}}") </p> </div> </div> </div>'),a.put("views/geospatial.html",'<div class="row"> <div class="col-sm-12"> <leaflet center="geospatial.mapcenter" markers="geospatial.markers" height="480px" width="1024px"></leaflet> </div> </div> <!--<div class="row">\n    <div class="col-sm-12">\n        <map center="[40.74, -74.18]" zoom="2">\n            <marker position="[{{office.lat}}, {{office.long}}]" ng-repeat="office in geospatial.offices"></marker>\n        </map>\n    </div>\n</div>-->'),a.put("views/line.html",'<canvas id="line" class="chart chart-line" chart-data="line.data" chart-labels="line.labels" chart-series="line.series" chart-options="line.options"> </canvas>'),a.put("views/metrics.html",'<div class="row"> <div class="col-xs-5 text-center"> <h1><b>{{metrics.open_issues}}</b></h1> <h4>Open Issues</h4> </div> <div class="col-xs-7" ng-include="\'views/line.html\'" ng-controller="LinechartCtrl as line"> </div> </div> <div class="row"> <div class="col-xs-8 col-xs-offset-2" ng-include="\'views/bar.html\'" ng-controller="BarchartCtrl as bar"> </div> </div>')}]);